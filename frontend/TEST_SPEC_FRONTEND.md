# フロントエンド単体テスト仕様書

## 1. 概要

- 対象プロジェクト: `ManavisGradesApp` フロントエンド（React + Vite）
- テストレベル: 単体テスト（ユーティリティ関数・主要コンポーネント）
- 想定ツール: `Jest` + `React Testing Library`
- 目的:
  - 成績集計ロジックなど、見た目に依存しない部分の振る舞いを保証する
  - 主要な UI コンポーネントの基本的な動作（タブ切り替えなど）を自動で検証する

---

## 2. テスト対象範囲

### 2.1 優先度 A（必須でテストを書く）

- `src/utils/exam-data-utils.ts`
  - 成績データの整形・集計ロジック
- `src/utils/subject-utils.ts`
  - 教科・科目名のグルーピング／変換ロジック
- `src/pages/Students/components/PerformanceDashboard.tsx`
  - 成績ダッシュボードのタブ切り替え動作

### 2.2 優先度 B（余裕があればテストを書く）

- `src/utils/pdf-utils.ts`
  - PDF 生成用のデータ整形ロジック（外部ライブラリ依存部分はモック）
- `src/api/*.jsx`
  - API 呼び出しのラッパー（エラーハンドリングなど）
- 画面コンポーネントのスナップショットテスト／簡易レンダリングテスト

---

## 3. テスト環境

- ディレクトリ構成（例）:

  ```text
  frontend/
    src/
      utils/
        exam-data-utils.ts
        subject-utils.ts
        pdf-utils.ts
      pages/
        Students/
          components/
            PerformanceDashboard.tsx
    __tests__/        または  各ファイルの隣に `*.test.ts(x)` を配置
  ```

- テストファイルの命名規則:
  - 対象ファイルと同じパス or `__tests__` ディレクトリ内に
    - `exam-data-utils.test.ts`
    - `subject-utils.test.ts`
    - `PerformanceDashboard.test.tsx`
  などの名称で配置する。

---

## 4. `exam-data-utils.ts` 単体テスト仕様

※ 実際の関数名は実装に合わせて補正する想定。ここでは代表例として `groupExamsByType` / `calculateAverageScore` といった関数を想定する。

### 4.1 `groupExamsByType(exams)`

**目的**  
模試一覧データを、種別（共テ / 記述 / 高1高2 / オープン など）ごとにグルーピングできることを確認する。

**前提データ例**

```ts
const exams = [
  { exam_id: 1, exam_type: "共テ", exam_year: 2024 },
  { exam_id: 2, exam_type: "記述", exam_year: 2024 },
  { exam_id: 3, exam_type: "共テ", exam_year: 2023 }
];
```

| テストID | 入力 | 期待結果（概要） |
|---------|------|------------------|
| FE-EX-101 | 上記 `exams` | 戻り値が `{ "共テ": [...2件], "記述": [...1件] }` のようなオブジェクトになり、各配列内に該当模試のみ含まれること。 |
| FE-EX-102 | 空配列 | 戻り値が空オブジェクト `{}` または空のマップになること。 |

### 4.2 `calculateAverageScore(scores)`

**目的**  
科目スコアの配列から平均点を正しく算出できることを確認する。

**前提データ例**

```ts
const scores = [
  { subject_code: 1, score: 80 },
  { subject_code: 2, score: 70 },
  { subject_code: 3, score: 90 }
];
```

| テストID | 入力 | 期待結果 |
|---------|------|----------|
| FE-EX-201 | 上記 `scores` | 平均値 `80` が返ること。 |
| FE-EX-202 | 空配列 | `0` または `null` など、実装で定めたデフォルト値が返ること。 |
| FE-EX-203 | 一部に `null` や `undefined` の score を含む | 無効な値を除外して平均を算出する、もしくはエラーを投げるなど、仕様どおりの動作をすること。 |

---

## 5. `subject-utils.ts` 単体テスト仕様

※ 実際の関数名に応じて読み替えること。

### 5.1 `groupSubjectsByCategory(subjects)`

**目的**  
科目一覧を「国語 / 数学 / 英語 / 理科 / 社会」などのカテゴリごとにグルーピングできることを確認する。

**前提データ例**

```ts
const subjects = [
  { subject_code: 1, subject_name: "現代文" },
  { subject_code: 2, subject_name: "古文" },
  { subject_code: 3, subject_name: "数学I・A" },
  { subject_code: 4, subject_name: "英語" }
];
```

| テストID | 入力 | 期待結果（概要） |
|---------|------|------------------|
| FE-SB-101 | 上記 `subjects` | 戻り値が `{ "国語": [...2件], "数学": [...1件], "英語": [...1件] }` のようにカテゴリ単位でグルーピングされていること。 |
| FE-SB-102 | 未知の科目名を含む | 未分類カテゴリ（例: `"その他"`）に入るなど、仕様どおりの扱いになること。 |

### 5.2 `getDisplaySubjectName(subjectCodeOrName)`

**目的**  
内部コードや略称を、画面表示用の分かりやすい名称に変換できることを確認する。

| テストID | 入力 | 期待結果 |
|---------|------|----------|
| FE-SB-201 | `"ENG"` | `"英語"` が返ること。 |
| FE-SB-202 | `"MATH1A"` | `"数学I・A"` が返ること。 |
| FE-SB-203 | 未定義コード | コードそのものを返す、もしくは `"不明科目"` などのフォールバックが返ること（実装仕様に合わせる）。 |

---

## 6. `PerformanceDashboard.tsx` 単体テスト仕様

パス: `src/pages/Students/components/PerformanceDashboard.tsx`

**目的**  
成績ダッシュボード画面において、タブ切り替えとコンテンツ表示の基本動作が正しく行われることを確認する。

### 6.1 初期表示

| テストID | 条件 | 期待結果 |
|---------|------|----------|
| FE-PD-101 | `exams` にダミーデータを渡してコンポーネントをレンダリングする | 初期状態で「共テ」タブがアクティブになっており、`CommonTestTab` に相当するコンテンツが表示されていること。タイトル「成績ダッシュボード」が表示されていること。 |

### 6.2 タブ切り替え

| テストID | 条件 | 操作 | 期待結果 |
|---------|------|------|----------|
| FE-PD-201 | FE-PD-101 と同様 | 「記述」タブをクリック | `DescriptiveTestTab` に相当するコンテンツが表示され、「共テ」タブの内容が非表示になっていること。 |
| FE-PD-202 | 同上 | 「高1/高2」タブをクリック | `High1High2TestTab` のコンテンツが表示されること。 |
| FE-PD-203 | 同上 | 「オープン」タブをクリック | `UniversityTestTab` のコンテンツが表示されること。 |

### 6.3 props の受け渡し

| テストID | 条件 | 期待結果 |
|---------|------|----------|
| FE-PD-301 | `exams` に特定の配列を渡す | アクティブなタブ配下の子コンポーネントに、`props.exams` がそのまま渡されていること（モックコンポーネントやスパイを使って確認）。 |

---

## 7. API ラッパー (`src/api/*.jsx`) の単体テスト仕様（概要）

**目的**  
バックエンドとの通信ラッパーが、成功時・エラー時に期待どおりの動作をすることを確認する。

### 7.1 `students.jsx` の例（関数名は実装に合わせて補正）

主な観点:

- 成功レスポンスを受け取った際に、想定された型（配列／オブジェクト）に整形されて返されること
- 4xx / 5xx エラー時に、例外を投げる or エラーオブジェクトを返すなど、実装仕様どおりのハンドリングが行われること
- 認証トークン（必要な場合）が正しくヘッダに付与されること（axios モックで確認）

---

## 8. エビデンスの扱い

- ローカル実行:
  - `npm test` または `npm run test:unit` 等でテストを実行し、コンソールログを残す。
- CI 実行:
  - GitHub Actions 等でテストを自動実行し、失敗時にどのテスト ID が落ちたか分かるようにする。


